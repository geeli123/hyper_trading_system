<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>交易系统控制台</title>
  <link rel="stylesheet" href="/styles.css" />
  <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
</head>
<body>
  <nav class="nav">
    <a href="#/monitor" id="tab-monitor">监听情况</a>
    <a href="#/account" id="tab-account">账号信息</a>
    <a href="#/settings" id="tab-settings">设置</a>
  </nav>
  <main id="app">
    <!-- 监听情况 -->
    <section v-if="route==='monitor'">
      <div class="row">
        <button class="btn" @click="createFromFirstTemplate">创建(用模板)</button>
        <button class="btn ghost" @click="clearAll">暂停/清空</button>
      </div>

      <div class="card">
        <div class="stat">
          <div class="kpi"><div class="value">{{ status.ws_ready ? '是' : '否' }}</div><div class="label">WS就绪</div></div>
          <div class="kpi"><div class="value">{{ status.active_subscriptions }}</div><div class="label">活跃订阅</div></div>
          <div class="kpi"><div class="value">{{ status.subscription_stats?.total ?? 0 }}</div><div class="label">总数</div></div>
        </div>
      </div>

      <div class="card">
        <h3>当前订阅</h3>
        <table class="table">
          <thead><tr><th>ID</th><th>类型</th><th>状态</th><th>操作</th></tr></thead>
          <tbody>
            <tr v-for="s in subs" :key="s.id">
              <td>{{ s.id }}</td>
              <td>{{ s.type }}</td>
              <td>{{ s.status }}</td>
              <td><button class="btn danger" @click="removeSub(s.id)">删除</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 账号信息 -->
    <section v-if="route==='account'">
      <div class="card">
        <h3>新增/更新账号</h3>
        <div class="row">
          <input class="input" placeholder="别名 alias" v-model="accountForm.alias">
          <input class="input" placeholder="account_address" v-model="accountForm.account_address">
          <input class="input" placeholder="api_wallet_address" v-model="accountForm.api_wallet_address">
          <input class="input" placeholder="secret_key" v-model="accountForm.secret_key">
          <button class="btn" @click="saveAccount">保存</button>
        </div>
      </div>
      <div class="card">
        <h3>账号列表</h3>
        <table class="table">
          <thead><tr><th>别名</th><th>account_address</th><th>api_wallet_address</th><th>启用</th><th>操作</th></tr></thead>
          <tbody>
            <tr v-for="a in accounts" :key="a.id">
              <td>{{ a.alias }}</td>
              <td>{{ a.account_address }}</td>
              <td>{{ a.api_wallet_address }}</td>
              <td>{{ a.is_active ? '是' : '否' }}</td>
              <td><button class="btn danger" @click="deleteAccount(a.alias)">删除</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 设置 -->
    <section v-if="route==='settings'">
      <div class="card">
        <h3>新增/更新配置</h3>
        <div class="row">
          <input class="input" placeholder="key" v-model="configForm.key">
          <input class="input" placeholder="value" v-model="configForm.value">
          <input class="input" placeholder="description" v-model="configForm.description">
          <input class="input" placeholder="config_type" v-model="configForm.config_type">
          <button class="btn" @click="saveConfig">保存</button>
        </div>
      </div>
      <div class="card">
        <h3>配置列表</h3>
        <table class="table">
          <thead><tr><th>Key</th><th>Value</th><th>Type</th><th>描述</th><th>操作</th></tr></thead>
          <tbody>
            <tr v-for="c in configs" :key="c.id">
              <td>{{ c.key }}</td>
              <td style="max-width:360px;overflow:auto">{{ c.value }}</td>
              <td>{{ c.config_type }}</td>
              <td>{{ c.description }}</td>
              <td><button class="btn danger" @click="deleteConfig(c.key)">删除</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>
  <script src="/main.js"></script>
</body>
</html>


