{% extends "base.html" %}

{% block title %}Home - Trading System Console{% endblock %}

{% block content %}
<div class="card">
  <h3>Create Subscription</h3>
  <div class="row">
    <input class="input" placeholder="Name *" v-model="form.name" required>
    <select class="input" v-model="form.coin" required>
      <option value="">Select Coin *</option>
      <option value="ETH">ETH</option>
    </select>
    <select class="input" v-model="form.interval" required>
      <option value="">Select Interval *</option>
      <option value="1m">1m</option>
      <option value="5m">5m</option>
      <option value="15m">15m</option>
      <option value="1h">1h</option>
    </select>
    <select class="input" v-model="form.account_alias" required>
      <option value="">Select Account *</option>
      <option v-for="a in accounts" :key="a.id" :value="a.alias">{{ a.alias }}</option>
    </select>
    <button class="btn" @click="createSubscription">Create</button>
    <button class="btn ghost" @click="clearAll">Pause / Clear</button>
    <button class="btn" @click="testNotification" style="background: #007bff;">Test Notification</button>
  </div>
</div>

<div class="card">
  <div class="stat">
    <div class="kpi"><div class="value">{{ status.ws_ready ? 'Yes' : 'No' }}</div><div class="label">WS Ready</div></div>
    <div class="kpi"><div class="value">{{ status.active_subscriptions }}</div><div class="label">Active</div></div>
    <div class="kpi"><div class="value">{{ status.subscription_stats?.total ?? 0 }}</div><div class="label">Total</div></div>
  </div>
</div>

<div class="card">
  <h3>Current Subscriptions</h3>
  <table class="table">
    <thead><tr><th>ID</th><th>Type</th><th>Status</th><th>Action</th></tr></thead>
    <tbody>
      <tr v-for="s in subs" :key="s.id">
        <td>{{ s.id }}</td>
        <td>{{ s.type }}</td>
        <td>{{ s.status }}</td>
        <td>
          <button class="btn danger" @click="removeSub(s.id)">Delete</button>
          <button class="btn ghost" v-if="s.status==='error'" @click="retrySub(s.id)" style="margin-left:8px">Retry</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
{% endblock %}
